# Changelog

All notable changes to Freedify will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/).

---

## [Unreleased]

---

## [1.1.7] - 2026-02-24

### Fixed
- **Random Mid-Playback Pauses**: Fixed `performGaplessSwitch` and `performCrossfade` order-of-operations bug where `activePlayer` was switched AFTER pausing the old player, causing `handlePause` to falsely set `isPlaying = false` during transitions.
- **Half-Second Play Then Reload**: Fixed `togglePlay` catch handler that called `loadTrack()` on play failure instead of resuming AudioContext — now tries `audioContext.resume()` first (common issue on mobile after screen lock).
- **Gapless Reliability**: Eliminated parallel track-advance code path in `handleTimeUpdate` that bypassed `playNext()` — all track transitions now flow through a single `playNext()` function.
- **Queue Progression**: Fixed self-blocking bug where `handleTimeUpdate` set `transitionInProgress` before calling `playNext()`, causing it to immediately return and stop the queue.
- **EQ Audio Dropout**: EQ initialization `play` handler was only on `audioPlayer`, not `audioPlayer2` — if player 2 started first, AudioContext would remain suspended. Now handles both players symmetrically.
- **Mute Button**: Fixed mute toggle only setting `audioPlayer.volume` — now sets both `audioPlayer` and `audioPlayer2` volume for correct behavior regardless of which player is active.
- **Preload Consistency**: Changed preload ready detection from `canplay` to `canplaythrough` to match `loadTrack` behavior, preventing premature transition attempts.

### Changed
- **Stream-Through Proxy**: Tidal and Deezer audio now streams directly from source to browser via chunk-by-chunk proxy instead of downloading the entire file (38+ MB) to the server first. Cuts initial load time from ~5s to under 1s.
- **Crossfade Support in Queue**: `playNext` and `playTrack` now correctly choose between crossfade and gapless switch based on user preference (previously always used gapless).
- **Code Quality**: Collapsed ~100 lines of double-line-spacing artifact from previous fix, removed duplicate `state.crossfadeEnabled` declaration.

---


## [1.1.6] - 2026-02-24

### Fixed
- **Gapless Playback**: Fixed double-firing `ended` event handler that caused skipped tracks, broken gapless transitions, and silent queue failures. Root cause: `removeEventListener` on anonymous function silently failed, leaving two competing handlers on the same player.
- **Song Stuttering**: Changed audio ready detection from `canplay` to `canplaythrough` so the browser buffers sufficient data before starting playback, eliminating the half-second stutter/rebuffer at track start.
- **Queue Progression**: `playNext` now properly handles Repeat All (loops back to start) and Repeat One (restarts current track) — previously only worked on player 1 due to handler mismatch.
- **Mid-Playback Stops**: `transitionInProgress` flag now resets on every fresh `loadTrack` call, preventing stuck state that suppressed all track advancement.
- **Pause State Bug**: Fixed `handlePause` using incorrect `this` context in event listener — now uses `e.target` for reliable active player detection.
- **FLAC Download Speed**: FLAC-to-FLAC downloads now bypass FFmpeg entirely when source is already FLAC (detects `fLaC` magic bytes), saving 5-15 seconds per track.

### Removed
- ~430 lines of zombie/duplicate code from frontend including: duplicate `showDetailView`, `openArtist`, `openDownloadModal`, `closeDownloadModal`, `downloadConfirmBtn` handler, `updateMediaSession`, keyboard shortcut handlers (×3), service worker registration, `addToQueue`, and `fsNextBtn` handler.
- Dead `stream_generator` function (42 lines) from backend `main.py`.

---


## [1.1.5] - 2026-01-26

### Added
- **Background Downloading**: Downloads now run in the background with a non-intrusive status indicator, allowing you to browse and stream music while downloading.
- **Download Status Pill**: Floating progress indicator shows download status and can be minimized.
- **Parallel Processing**: Streaming and downloading can now be performed simultaneously without blocking the UI.
- **Concurrent Batch Downloads**: Batch downloads now process 3 tracks in parallel for significantly faster speeds, with automatic API fallback.

### Fixed
- **Metadata Embedding**: Fixed issue where metadata (Cover Art, Artist, Album) was missing for 24-bit FLAC and ALAC downloads.
- **Format Support**: Extended tagging support to include ALAC (.m4a) and ensured all FLAC bit-depths are handled correctly.

---

## [1.1.4] - 2026-01-23

### Added
- **Selective Track Download**: Checkboxes on each track in album/playlist/queue modals to select specific songs to download
- **Select All Toggle**: Quick select/deselect all tracks with selection count display
- **Queue Download**: Added "Download Selected" button to queue controls

---

## [1.1.3] - 2026-01-23

### Fixed
- **Mobile Gapless Playback**: Fixed "false start" bug where tracks would play briefly, pause for 20 seconds, then restart from beginning when screen is off
- **Track Transition Race Condition**: Added `transitionInProgress` lock to prevent double-trigger between gapless switch and ended event handlers

### Changed
- **Mobile Album Modal**: Two-row track layout on mobile - track name on top row, action buttons (star, heart, duration, queue, download) on second row for better readability
- **Star Icon Visibility**: Star button now uses white outline and gold fill when starred, with glow effect
- **Preload Timing**: Replaced setTimeout with requestAnimationFrame for mobile-friendly track preloading

---

## [1.1.2] - 2026-01-22

### Added
- **Jump Back In Dashboard**: Home screen now shows personalized sections for recent albums, artists, library, and playlists
- **My Library (⭐)**: Save tracks with star icon - separate from playlists, syncs with Google Drive
- **Listening History**: Tracks your last 50 played songs, persists across sessions
- **Library View**: Click "See All" on the dashboard to browse your full starred collection

### Changed
- **Google Drive Sync**: Now syncs Library and History alongside playlists
- **Search Cards**: Added star (☆/★) button to quickly save tracks

---

## [1.1.1] - 2026-01-21

### Fixed
- **Download Metadata**: Fixed "Album: test" overwriting actual album tags in playlist downloads via new Strict Mode logic
- **Album Art**: Fixed missing art/metadata by adding automatic MusicBrainz fallback when primary source fails
- **FLAC Duration**: Fixed 00:00 duration/seeking issues in VLC (corrected ffmpeg pipe handling)
- **Stability**: Hardened backend against 404s and empty metadata fields

---

## [1.1.0] - 2026-01-21

### Added
- **Multi-arch Docker**: ARM64 support for Raspberry Pi, Apple Silicon (M1/M2/M3), and ARM servers
- **Termux/Android support**: Run Freedify directly on Android via Termux
- **Termux documentation**: New section in README and deployment guide
- **Cross-platform cache**: Cache now defaults to `~/.freedify_cache` (works on Termux)
- **Apple Music workaround**: Documentation for importing Apple Music playlists via Spotify

### Changed
- **Docker workflow**: Added QEMU emulation for ARM64 builds
- **Cache filenames**: MD5 hash long `LINK:` IDs to prevent filename errors
- **API reliability**: Updated Tidal fallback servers (squid, spotisaver, kinoplus, binimum, qqdl)
- **User-Agent header**: Added custom `Freedify/1.0` User-Agent for API requests

### Fixed
- **iOS audio**: Added silent audio keepalive to prevent screen lock suspension
- **Keyboard shortcuts**: Play/pause now correctly uses Enter key (not Space)
- **Docker Compose**: Updated to use Docker Hub image by default with NAS-friendly options

---

## [1.0.0] - 2026-01-18

### Added
- Initial public release
- Lossless FLAC streaming (16-bit & 24-bit Hi-Res)
- AI Smart Playlists with Gemini
- Multi-source search (Deezer, YouTube Music, Jamendo, Phish.in)
- Google Drive sync for playlists
- ListenBrainz scrobbling
- Docker support with auto-publish to Docker Hub
- Visual deployment guide for Localhost, Railway, and Render

---

*For changes before v1.0, see [commit history](https://github.com/BioHapHazard/Freedify/commits/main).*
