services:
  freedify:
    # Option 1: Use pre-built image from Docker Hub (recommended)
    image: biohaphazard/freedify:latest
    # Option 2: Build from source (uncomment below, comment out image above)
    # build: .
    container_name: freedify
    ports:
      - "8000:8000"
    env_file:
      - .env
    environment:
      - PORT=8000
      - MP3_BITRATE=320k
      # Below variables map to your local .env file.
      # You do not need to edit these here.
      - TZ=${TZ:-America/New_York}
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - DAB_SESSION=${DAB_SESSION:-}
      - DAB_VISITOR_ID=${DAB_VISITOR_ID:-}
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
      - GENIUS_ACCESS_TOKEN=${GENIUS_ACCESS_TOKEN:-}
      - LISTENBRAINZ_TOKEN=${LISTENBRAINZ_TOKEN:-}
      - PODCASTINDEX_KEY=${PODCASTINDEX_KEY:-}
      - PODCASTINDEX_SECRET=${PODCASTINDEX_SECRET:-}
      - TICKETMASTER_API_KEY=${TICKETMASTER_API_KEY:-}
      - SEATGEEK_CLIENT_ID=${SEATGEEK_CLIENT_ID:-}
      - SETLIST_FM_API_KEY=${SETLIST_FM_API_KEY:-}
      - SPOTIFY_CLIENT_ID=${SPOTIFY_CLIENT_ID:-}
      - SPOTIFY_CLIENT_SECRET=${SPOTIFY_CLIENT_SECRET:-}
      - SPOTIFY_SP_DC=${SPOTIFY_SP_DC:-}
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID:-}
      - JAMENDO_CLIENT_ID=${JAMENDO_CLIENT_ID:-}
    volumes:
      # Persist cache for faster repeated plays
      - freedify-cache:/app/cache
      # For NAS users with custom paths, use:
      # - /your/nas/path/freedify-cache:/app/cache
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python", "-c", "import httpx; httpx.get('http://localhost:8000/api/health')" ]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  freedify-cache:
